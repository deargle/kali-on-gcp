#!/bin/bash -ex
if ! which vagrant ; then
  sed -e 's/^# deb-src/deb-src/g' -i /etc/apt/sources.list
  apt update

  apt build-dep -y vagrant ruby-libvirt
  apt install -y  qemu libvirt-daemon-system libvirt-clients ebtables dnsmasq-base
  apt install -y libxslt-dev libxml2-dev libvirt-dev zlib1g-dev ruby-dev

  wget -q https://releases.hashicorp.com/vagrant/2.2.9/vagrant_2.2.9_x86_64.deb
  apt install ./vagrant_2.2.9_x86_64.deb
else
  echo 'vagrant command already available, not installing...'
fi

if ! vagrant plugin list | grep -q vagrant-libvirt ; then
  vagrant plugin install vagrant-libvirt
else
  echo 'vagrant plugin "vagrant-libvirt" already installed, skipping...'
fi

#if virsh net-info vagrant-libvirt && ! virsh net-info vagrant-libvirt | grep Active | grep yes ; then
#  virsh net-start vagrant-libvirt
#fi
#virsh net-autostart vagrant-libvirt
